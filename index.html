<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player Master</title>
    <style>
        :root { --p1: #7b2ff7; --p2: #3f0a8e; --txt: #ffffff; }
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background: transparent; }
        
        /* –°—Ç–∏–ª–∏ –†–µ–¥–∞–∫—Ç–æ—Ä–∞ (—Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ –≤–∏–¥–∂–µ—Ç–∞) */
        #editor-ui { 
            background: #f0f2f5; padding: 30px; min-height: 100vh; 
            display: flex; flex-direction: column; align-items: center; 
        }
        .config-card { 
            background: white; padding: 25px; border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 500px; margin-bottom: 30px;
        }
        .field { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; color: #444; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        textarea { width: 100%; height: 80px; margin-top: 10px; border-radius: 8px; border: 1px solid #ccc; font-family: monospace; font-size: 12px; }

        /* –°–¢–ò–õ–ò –ü–õ–ï–ï–†–ê (–†–µ—Ñ–µ—Ä–µ–Ω—Å Drake/Scorpion) */
        .player-container {
            width: 450px; height: 160px; 
            background: linear-gradient(135deg, var(--p1) 0%, var(--p2) 100%);
            border-radius: 24px; display: flex; align-items: center; 
            padding: 20px; color: var(--txt); position: relative; 
            overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .album-art { 
            width: 100px; height: 100px; border-radius: 50%; 
            border: 4px solid rgba(255,255,255,0.2); object-fit: cover;
            animation: rotate 10s linear infinite paused; flex-shrink: 0;
        }
        .playing .album-art { animation-play-state: running; }
        .info { margin-left: 20px; flex-grow: 1; z-index: 2; }
        .info h3 { margin: 0; font-size: 18px; }
        .info p { margin: 5px 0; font-size: 14px; opacity: 0.8; }
        
        .controls { display: flex; align-items: center; gap: 12px; margin-top: 10px; }
        .btn { background: none; border: none; color: white; cursor: pointer; font-size: 20px; transition: 0.2s; }
        .btn:hover { transform: scale(1.1); }
        .btn-play { background: white; color: var(--p1); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        
        .progress-box { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 10px; cursor: pointer; }
        .progress-bar { height: 100%; background: var(--txt); width: 0%; border-radius: 2px; }

        /* –í–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä */
        .viz { position: absolute; bottom: 0; left: 0; display: flex; gap: 2px; padding: 10px; opacity: 0.2; align-items: flex-end; }
        .bar { width: 6px; background: white; height: 10px; animation: bounce 0.5s infinite alternate paused; }
        .playing .bar { animation-play-state: running; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes bounce { from { height: 4px; } to { height: 30px; } }
        
        /* –†–µ–∂–∏–º –≤–∏–¥–∂–µ—Ç–∞: —Å–∫—Ä—ã—Ç—å –≤—Å—ë –ª–∏—à–Ω–µ–µ */
        body.widget-mode #editor-ui { display: none; }
        body.widget-mode { display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
    </style>
</head>
<body>

<div id="editor-ui">
    <h1>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–µ–µ—Ä–∞</h1>
    <div class="config-card">
        <div class="field">
            <label>–¶–≤–µ—Ç 1 (–ì—Ä–∞–¥–∏–µ–Ω—Ç)</label>
            <input type="color" id="c1" value="#7b2ff7" oninput="liveUpdate()">
        </div>
        <div class="field">
            <label>–¶–≤–µ—Ç 2 (–ì—Ä–∞–¥–∏–µ–Ω—Ç)</label>
            <input type="color" id="c2" value="#3f0a8e" oninput="liveUpdate()">
        </div>
        <div class="field">
            <label>–°—Å—ã–ª–∫–∞ –Ω–∞ JSON –ø–ª–µ–π–ª–∏—Å—Ç–∞</label>
            <input type="text" id="jsonInput" value="https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/player/main/playlist.json" oninput="liveUpdate()">
        </div>
        <label>–ö–æ–¥ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ Genially:</label>
        <textarea id="resCode" readonly></textarea>
    </div>
    
    <h2>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä:</h2>
    <div id="preview-box"></div>
</div>

<div id="player-anchor">
    <div class="player-container" id="plBody">
        <div class="viz">
            <div class="bar" style="animation-delay:0s"></div>
            <div class="bar" style="animation-delay:0.2s"></div>
            <div class="bar" style="animation-delay:0.4s"></div>
            <div class="bar" style="animation-delay:0.1s"></div>
        </div>
        <img src="cover.jpg" id="pCover" class="album-art">
        <div class="info">
            <h3 id="pTitle">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
            <p id="pArtist">...</p>
            <div class="progress-box" onclick="seek(event)">
                <div class="progress-bar" id="pBar"></div>
            </div>
            <div class="controls">
                <button class="btn" onclick="prev()">‚èÆ</button>
                <button class="btn btn-play" onclick="togglePlay()" id="pPlay">‚ñ∂</button>
                <button class="btn" onclick="next()">‚è≠</button>
                <button class="btn" onclick="toggleShuf()" id="pShuf" style="opacity:0.5; font-size: 14px;">üîÄ</button>
            </div>
        </div>
    </div>
</div>

<script>
    let tracks = [];
    let current = 0;
    let isPlaying = false;
    let isShuffle = false;
    const audio = new Audio();
    const params = new URLSearchParams(window.location.search);

    // 1. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –†–ï–ñ–ò–ú–ê
    if (params.has('view')) {
        document.body.classList.add('widget-mode');
        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ü–≤–µ—Ç–∞ –∏–∑ URL
        if(params.has('c1')) document.documentElement.style.setProperty('--p1', '#' + params.get('c1'));
        if(params.has('c2')) document.documentElement.style.setProperty('--p2', '#' + params.get('c2'));
    }

    // 2. –õ–û–ì–ò–ö–ê –ü–õ–ï–ï–†–ê
    async function loadPlaylist(url) {
        try {
            const r = await fetch(url);
            const d = await r.json();
            tracks = d.tracks;
            renderTrack(0);
        } catch(e) { console.error("–û—à–∏–±–∫–∞ JSON"); }
    }

    function renderTrack(i) {
        const t = tracks[i];
        const githubBase = "https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/player/main/";
        audio.src = githubBase + t.file;
        document.getElementById('pTitle').innerText = t.title;
        document.getElementById('pArtist').innerText = t.artist;
        document.getElementById('pCover').src = githubBase + t.image;
    }

    function togglePlay() {
        if(isPlaying) audio.pause(); else audio.play();
        isPlaying = !isPlaying;
        document.getElementById('pPlay').innerText = isPlaying ? '‚è∏' : '‚ñ∂';
        document.getElementById('plBody').classList.toggle('playing', isPlaying);
    }

    function next() {
        current = isShuffle ? Math.floor(Math.random()*tracks.length) : (current + 1) % tracks.length;
        renderTrack(current); if(isPlaying) audio.play();
    }

    function prev() {
        current = (current - 1 + tracks.length) % tracks.length;
        renderTrack(current); if(isPlaying) audio.play();
    }

    function toggleShuf() {
        isShuffle = !isShuffle;
        document.getElementById('pShuf').style.opacity = isShuffle ? "1" : "0.5";
    }

    audio.ontimeupdate = () => {
        const p = (audio.currentTime / audio.duration) * 100 || 0;
        document.getElementById('pBar').style.width = p + '%';
    };
    audio.onended = () => next();

    // 3. –õ–û–ì–ò–ö–ê –†–ï–î–ê–ö–¢–û–†–ê
    function liveUpdate() {
        const color1 = document.getElementById('c1').value;
        const color2 = document.getElementById('c2').value;
        const json = document.getElementById('jsonInput').value;
        
        // –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–≤—å—é
        document.documentElement.style.setProperty('--p1', color1);
        document.documentElement.style.setProperty('--p2', color2);
        
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
        const cleanC1 = color1.replace('#','');
        const cleanC2 = color2.replace('#','');
        const myUrl = window.location.href.split('?')[0];
        const iframe = `<iframe src="${myUrl}?view=widget&c1=${cleanC1}&c2=${cleanC2}" width="460" height="180" frameborder="0" scrolling="no" style="background:transparent;"></iframe>`;
        
        document.getElementById('resCode').value = iframe;
    }

    // –ó–∞–ø—É—Å–∫
    const startJson = params.get('json') || document.getElementById('jsonInput').value;
    loadPlaylist(startJson);
    if(!params.has('view')) liveUpdate();

</script>
</body>
</html>
