<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player Editor for Genially</title>
    <style>
        :root { --primary-gradient: linear-gradient(135deg, #7b2ff7 0%, #3f0a8e 100%); --accent: #ffffff; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f4f7f6; margin: 0; padding: 20px; color: #2d3436; }
        .container { display: grid; grid-template-columns: 350px 1fr; gap: 20px; max-width: 1200px; margin: 0 auto; }
        .panel { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        h1, h2 { margin-top: 0; font-size: 1.4rem; color: #1e272e; }
        
        /* Editor UI */
        .field { margin-bottom: 15px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; color: #636e72; }
        input { width: 100%; padding: 10px; border: 1px solid #dfe6e9; border-radius: 8px; box-sizing: border-box; }
        input[type="color"] { height: 40px; cursor: pointer; padding: 2px; }
        button#generateBtn { background: #7b2ff7; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button#generateBtn:hover { background: #5f10e0; }
        textarea { width: 100%; height: 120px; margin-top: 15px; border-radius: 8px; border: 1px solid #dfe6e9; background: #fafafa; font-family: monospace; font-size: 11px; padding: 10px; box-sizing: border-box; }

        /* Real Player Preview Styles */
        .preview-area { display: flex; align-items: center; justify-content: center; background: #e2e8f0; border-radius: 15px; min-height: 400px; }
        .player-card { 
            width: 450px; height: 160px; background: var(--primary-gradient); 
            border-radius: 24px; position: relative; padding: 20px; 
            color: white; display: flex; align-items: center; overflow: hidden;
            box-shadow: 0 15px 35px rgba(123, 47, 247, 0.3);
        }
        .album-wrapper { position: relative; z-index: 2; flex-shrink: 0; }
        .album-art { 
            width: 110px; height: 110px; border-radius: 50%; border: 3px solid rgba(255,255,255,0.3);
            object-fit: cover; animation: rotate 12s linear infinite paused;
        }
        .playing .album-art { animation-play-state: running; }
        
        .player-content { flex-grow: 1; margin-left: 20px; z-index: 2; }
        .track-info h3 { margin: 0; font-size: 18px; letter-spacing: 0.5px; }
        .track-info p { margin: 4px 0; font-size: 13px; opacity: 0.8; }
        
        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin: 12px 0; cursor: pointer; position: relative; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; border-radius: 2px; transition: width 0.1s; }
        
        .controls { display: flex; align-items: center; gap: 15px; }
        .btn { background: none; border: none; color: white; cursor: pointer; font-size: 18px; padding: 0; transition: 0.2s; opacity: 0.9; }
        .btn:hover { opacity: 1; transform: scale(1.1); }
        .btn-play { background: white; color: #7b2ff7; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; }
        
        /* Visualizer */
        .vis { position: absolute; bottom: 0; left: 0; display: flex; align-items: flex-end; gap: 2px; padding: 10px; opacity: 0.2; }
        .bar { width: 6px; background: white; height: 10px; border-radius: 1px; animation: bounce 0.6s infinite alternate paused; }
        .playing .bar { animation-play-state: running; }

        @keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes bounce { from { height: 5px; } to { height: 30px; } }
    </style>
</head>
<body>

<div class="container">
    <div class="panel">
        <h2>–†–µ–¥–∞–∫—Ç–æ—Ä –ø–ª–µ–µ—Ä–∞</h2>
        <div class="field">
            <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (–ù–∞—á–∞–ª—å–Ω—ã–π)</label>
            <input type="color" id="color1" value="#7b2ff7" oninput="updateStyle()">
        </div>
        <div class="field">
            <label>–¶–≤–µ—Ç —Ñ–æ–Ω–∞ (–ö–æ–Ω–µ—á–Ω—ã–π)</label>
            <input type="color" id="color2" value="#3f0a8e" oninput="updateStyle()">
        </div>
        <div class="field">
            <label>URL –ü–ª–µ–π–ª–∏—Å—Ç–∞ (JSON)</label>
            <input type="text" id="jsonUrl" value="https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/player/main/playlist.json">
        </div>
        <button id="generateBtn" onclick="generateEmbed()">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
        <textarea id="output" readonly placeholder="–ó–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à –∫–æ–¥..."></textarea>
    </div>

    <div class="preview-area">
        <div class="player-card" id="player">
            <div class="vis">
                <div class="bar" style="animation-delay: 0s"></div>
                <div class="bar" style="animation-delay: 0.2s"></div>
                <div class="bar" style="animation-delay: 0.1s"></div>
                <div class="bar" style="animation-delay: 0.4s"></div>
            </div>
            <div class="album-wrapper">
                <img src="https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/player/main/cover.jpg" id="art" class="album-art">
            </div>
            <div class="player-content">
                <div class="track-info">
                    <h3 id="title">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏</h3>
                    <p id="artist">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å</p>
                </div>
                <div class="progress-bar" id="progressRoot">
                    <div class="progress-fill" id="fill"></div>
                </div>
                <div class="controls">
                    <button class="btn" onclick="prev()">‚èÆ</button>
                    <button class="btn btn-play" onclick="toggle()">‚ñ∂</button>
                    <button class="btn" onclick="next()">‚è≠</button>
                    <button class="btn" id="shuf" onclick="toggleShuf()" style="font-size: 14px; opacity: 0.5;">üîÄ</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let tracks = [];
    let cur = 0;
    let isPlay = false;
    let isShuf = false;
    const audio = new Audio();
    const base = "https://raw.githubusercontent.com/EnglishTeacherOlgaKutsepalova/player/main/";

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    fetch(document.getElementById('jsonUrl').value)
        .then(r => r.json())
        .then(d => { 
            tracks = d.tracks; 
            load(0); 
        });

    function load(idx) {
        const t = tracks[idx];
        audio.src = base + t.file;
        document.getElementById('title').innerText = t.title;
        document.getElementById('artist').innerText = t.artist;
        document.getElementById('art').src = base + t.image;
    }

    function toggle() {
        if(isPlay) { audio.pause(); } else { audio.play(); }
        isPlay = !isPlay;
        document.querySelector('.btn-play').innerText = isPlay ? '‚è∏' : '‚ñ∂';
        document.getElementById('player').classList.toggle('playing', isPlay);
    }

    function next() {
        cur = isShuf ? Math.floor(Math.random() * tracks.length) : (cur + 1) % tracks.length;
        load(cur); if(isPlay) audio.play();
    }

    function prev() {
        cur = (cur - 1 + tracks.length) % tracks.length;
        load(cur); if(isPlay) audio.play();
    }

    function toggleShuf() {
        isShuf = !isShuf;
        document.getElementById('shuf').style.opacity = isShuf ? "1" : "0.5";
    }

    function updateStyle() {
        const c1 = document.getElementById('color1').value;
        const c2 = document.getElementById('color2').value;
        document.getElementById('player').style.background = `linear-gradient(135deg, ${c1} 0%, ${c2} 100%)`;
    }

    audio.ontimeupdate = () => {
        const p = (audio.currentTime / audio.duration) * 100 || 0;
        document.getElementById('fill').style.width = p + '%';
    };

    function generateEmbed() {
        const c1 = document.getElementById('color1').value;
        const c2 = document.getElementById('color2').value;
        const json = document.getElementById('jsonUrl').value;
        
        // –ó–¥–µ—Å—å –º—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º iFrame, –∫–æ—Ç–æ—Ä—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ —Ç–≤–æ—é –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É, –Ω–æ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
        const finalCode = `<iframe src="https://englishteacherolgakutsepalova.github.io/player/index.html?c1=${c1.replace('#','')}&c2=${c2.replace('#','')}" width="480" height="200" frameborder="0" scrolling="no" style="overflow:hidden; background:transparent;"></iframe>`;
        
        document.getElementById('output').value = finalCode;
        alert("–ö–æ–¥ –≥–æ—Ç–æ–≤! –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ Genially.");
    }
</script>
</body>
</html>
